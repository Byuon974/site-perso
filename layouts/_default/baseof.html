<!DOCTYPE html>
<html lang="fr">
  <head>
    {{ partial "head.html" . }}
  </head>
  <body>
    <a class="skip-link" href="#content">Aller au contenu</a>
    <div class="layout">
      {{/* Sidebar fixe */}}
      <aside class="sidebar" id="sidebar" aria-label="Navigation">
        <div class="sidebar-inner">
          {{/* Section courante */}}
          {{ if .Title }}
          <div class="sidebar-current">
            <span class="sidebar-label">current</span>
            <span class="sidebar-current-title">{{ .Title }}</span>
          </div>
          {{ end }}

          {{/* TOC pour pages single */}}
          {{ if and .IsPage .TableOfContents }}
          {{ $toc := .TableOfContents }}
          {{ if $toc }}
          <nav class="sidebar-toc">
            <span class="sidebar-label">contents</span>
            {{ $toc }}
          </nav>
          {{ end }}
          {{ end }}

          {{/* Navigation */}}
          <nav class="sidebar-nav">
            <span class="sidebar-label">explore</span>
            <ul>
              <li><a href="{{ "/" | relURL }}"{{ if .IsHome }} class="active" aria-current="page"{{ end }}>Accueil</a></li>
              <li><a href="{{ "/projets/" | relURL }}"{{ if eq .Section "projets" }} class="active" aria-current="page"{{ end }}>Projets</a></li>
              <li><a href="{{ "/blog/" | relURL }}"{{ if eq .Section "blog" }} class="active" aria-current="page"{{ end }}>Blog</a></li>
              <li><a href="{{ "/notes/" | relURL }}"{{ if eq .Section "notes" }} class="active" aria-current="page"{{ end }}>Notes</a></li>
              <li><a href="{{ "/about/" | relURL }}"{{ if eq .Section "about" }} class="active" aria-current="page"{{ end }}>Ã€ propos</a></li>
            </ul>
          </nav>

          {{/* Footer sidebar */}}
          <div class="sidebar-footer">
            <button class="theme-toggle" type="button" data-theme-toggle aria-label="Basculer le mode">
              ðŸŒ™
            </button>
          </div>
        </div>
      </aside>

      {{/* Overlay pour mobile */}}
      <div class="sidebar-overlay" id="sidebar-overlay" aria-hidden="true"></div>

      {{/* Bouton mobile */}}
      <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="sidebar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      {{/* Contenu principal */}}
      <main class="main-content" id="content">
        {{/* Header avec logo */}}
        <header class="main-header">
          <a href="{{ "/" | relURL }}" class="main-header-logo">
            <img src="{{ "favicon-192.png" | relURL }}" alt="Logo" width="32" height="32" decoding="async" />
            <span>nexus<span class="sep">-</span>tvs</span>
          </a>
        </header>

        {{ block "main" . }}{{ end }}
        {{ partial "footer.html" . }}
      </main>
    </div>
    
    <div id="fullscreen"></div>

    <script defer src="https://unpkg.com/littlefoot@4.0.1/dist/littlefoot.js"></script>
    <script>window.addEventListener("DOMContentLoaded", () => { if (window.littlefoot) { window.littlefoot.littlefoot(); } });</script>
    <script defer src="{{ "js/image-viewer.js" | relURL }}"></script>
    <script defer src="{{ "js/theme-toggle.js" | relURL }}"></script>
    <script>
      // Sidebar mobile avec overlay
      (function() {
        const toggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        
        if (!toggle || !sidebar || !overlay) return;

        function openSidebar() {
          sidebar.classList.add('open');
          overlay.classList.add('visible');
          overlay.setAttribute('aria-hidden', 'false');
          toggle.setAttribute('aria-expanded', 'true');
          toggle.setAttribute('aria-label', 'Fermer le menu');
          document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
          sidebar.classList.remove('open');
          overlay.classList.remove('visible');
          overlay.setAttribute('aria-hidden', 'true');
          toggle.setAttribute('aria-expanded', 'false');
          toggle.setAttribute('aria-label', 'Ouvrir le menu');
          document.body.style.overflow = '';
        }

        function toggleSidebar() {
          if (sidebar.classList.contains('open')) {
            closeSidebar();
          } else {
            openSidebar();
          }
        }

        // Toggle button
        toggle.addEventListener('click', toggleSidebar);

        // Clic sur overlay = fermer
        overlay.addEventListener('click', closeSidebar);

        // Escape = fermer
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && sidebar.classList.contains('open')) {
            closeSidebar();
            toggle.focus();
          }
        });
        // PiÃ©geage du focus (accessibilitÃ©) quand le menu est ouvert
        document.addEventListener('keydown', (e) => {
          if (e.key !== 'Tab' || !sidebar.classList.contains('open')) return;

          const focusables = sidebar.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
          if (!focusables.length) return;

          const first = focusables[0];
          const last = focusables[focusables.length - 1];

          if (e.shiftKey && document.activeElement === first) {
            e.preventDefault();
            last.focus();
          } else if (!e.shiftKey && document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        });


        // Fermer si on clique sur un lien (navigation)
        sidebar.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
              closeSidebar();
            }
          });
        });

        // Reset au resize (si on passe en desktop)
        window.addEventListener('resize', () => {
          if (window.innerWidth > 768) {
            sidebar.classList.remove('open');
            overlay.classList.remove('visible');
          overlay.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            toggle.setAttribute('aria-expanded', 'false');
          }
        });
      })();
    </script>
  </body>
</html>
